import { describe, test, expect } from "bun:test";
import { hexToBytes } from "../src/utils";
import { Strumok } from "../src";

describe("Encryption/Decryption", () => {
    const key = hexToBytes("00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000")
    const iv = hexToBytes("0000000000000001000000000000000200000000000000030000000000000004")
    const data = new Uint8Array(272)
    data[0] = 0xAA
    const expected = hexToBytes("00AA3381AE2EA1CC1D50E87C50858D52F123183EFEC783DA421AB763BF6E4121EB25A6F12B6DD726FC1E0BCDE06EC6EEA845A338F368DD02DB1A41A5908753479E61825449B49F9F6337749259C4DF423C885E88F457D703BE65865B25BFEE8D3312A332CA90D1EED635D4C2AEA227553796744AB222092F1A93CD38E4BA28ACA491C1B9A2F292C4A9D2B09EBED90FDDFD84E38AE0312937F9A97C99778F37FC31A5E5ECA2B12427769986515AF6DB4F148DE395B7217A7ED4FE43046D59D847FAE597218654C1E9E12FEDCAF815977F95C0ADF62895C91BBC6D1394FDEAD6B517C82B5C9F3696E35BF98AC502975815D6E01B3B0F0C9611945EF62A25055DE4416A49B183DA628D34B79454680CB323");

    test("Encryption", () => {
        let a = new Strumok(key, iv);
        expect(a.crypt(data)).toStrictEqual(expected)
    })

    test("Decryption", () => {
        let a = new Strumok(key, iv);
        expect(a.crypt(expected)).toStrictEqual(data)
    })
})